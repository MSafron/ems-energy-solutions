# EMC¬≥ Energy Solutions ‚Äî –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é

## üìã –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| **–ü—Ä–æ–µ–∫—Ç** | `ems-energy-solutions` |
| **–î–æ–º–µ–Ω** | emc3.ru |
| **–¶–µ–ª–µ–≤–æ–π —Å–µ—Ä–≤–µ—Ä** | Server 89 |
| **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** | SPA + Self-hosted Supabase |
| **–¢–∏–ø –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è** | –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π —Å–∞–π—Ç —Å –Ω–æ–≤–æ—Å—Ç–Ω—ã–º —Ä–∞–∑–¥–µ–ª–æ–º |

---

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### Frontend

| –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –í–µ—Ä—Å–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------------|--------|------------|
| React | 18.3.1 | UI –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ |
| Vite | 5.4.19 | –°–±–æ—Ä—â–∏–∫ |
| TypeScript | 5.8.3 | –¢–∏–ø–∏–∑–∞—Ü–∏—è |
| Tailwind CSS | 3.4.17 | –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è |
| shadcn/ui (Radix) | - | UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã |
| React Router DOM | 6.30.1 | –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è |
| TanStack Query | 5.83.0 | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∑–∞–ø—Ä–æ—Å–æ–≤ |
| react-helmet-async | 2.0.5 | SEO –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ |

### Backend (Self-hosted)

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-----------|------------|
| Supabase | BaaS –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ |
| PostgreSQL | –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö |
| PostgREST | REST API |
| Supabase Realtime | WebSocket –ø–æ–¥–ø–∏—Å–∫–∏ |

### –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è

| –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------------|------------|
| n8n | –ü–∞—Ä—Å–∏–Ω–≥ Telegram ‚Üí Supabase |

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
ems-energy-solutions/
‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îú‚îÄ‚îÄ favicon.png
‚îÇ   ‚îú‚îÄ‚îÄ og-image.jpg
‚îÇ   ‚îú‚îÄ‚îÄ robots.txt
‚îÇ   ‚îú‚îÄ‚îÄ sitemap.xml
‚îÇ   ‚îî‚îÄ‚îÄ videos/
‚îÇ       ‚îî‚îÄ‚îÄ hero-bg.mp4
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ assets/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ emc3-cube.png
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ emc3-logo.png
‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ui/                    # shadcn/ui –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ PageLayout.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ news/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CategoryFilter.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NewsCard.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NewsSection.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NewsSlider.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ShareButton.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ products/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PricingTable.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ProductCard.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ UseCaseCard.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ About.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Contact.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Directions.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ESCODiagram.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Footer.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Header.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Hero.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NavLink.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Portal.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Projects.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SEO.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Values.tsx
‚îÇ   ‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useNews.ts             # ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ use-mobile.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ use-toast.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useScrollAnimation.tsx
‚îÇ   ‚îú‚îÄ‚îÄ integrations/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ supabase/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ client.ts          # ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ types.ts           # ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Content.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Energy.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Index.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ News.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NewsArticle.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NotFound.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Platform.tsx
‚îÇ   ‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ news.ts
‚îÇ   ‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils.ts
‚îÇ   ‚îú‚îÄ‚îÄ App.tsx
‚îÇ   ‚îú‚îÄ‚îÄ main.tsx
‚îÇ   ‚îî‚îÄ‚îÄ index.css
‚îú‚îÄ‚îÄ supabase/
‚îÇ   ‚îî‚îÄ‚îÄ config.toml
‚îú‚îÄ‚îÄ .env                            # Lovable Cloud (–Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ prod)
‚îú‚îÄ‚îÄ .env.production                 # ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å
‚îú‚îÄ‚îÄ DEPLOYMENT.md
‚îú‚îÄ‚îÄ index.html
‚îú‚îÄ‚îÄ tailwind.config.ts
‚îú‚îÄ‚îÄ vite.config.ts
‚îî‚îÄ‚îÄ package.json
```

---

## üó∫ –ú–∞—Ä—à—Ä—É—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

| –ú–∞—Ä—à—Ä—É—Ç | –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|-----------|----------|
| `/` | `Index` | –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ |
| `/energy` | `Energy` | –≠–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è |
| `/platform` | `Platform` | –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ |
| `/content` | `Content` | –ö–æ–Ω—Ç–µ–Ω—Ç |
| `/news` | `News` | –°–ø–∏—Å–æ–∫ –Ω–æ–≤–æ—Å—Ç–µ–π |
| `/news/:slug` | `NewsArticle` | –°—Ç–∞—Ç—å—è –Ω–æ–≤–æ—Å—Ç–∏ |
| `*` | `NotFound` | 404 —Å—Ç—Ä–∞–Ω–∏—Ü–∞ |

---

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–µ–ø–ª–æ—è

```mermaid
graph TB
    subgraph "Server 89"
        subgraph "NGINX"
            STATIC["–°—Ç–∞—Ç–∏–∫–∞<br/>/var/www/emc3.ru/dist/"]
        end
        
        subgraph "Self-hosted Supabase"
            KONG["Kong API Gateway<br/>:8000"]
            POSTGREST["PostgREST<br/>:3000"]
            REALTIME["Realtime<br/>:4000"]
            POSTGRES["PostgreSQL<br/>:5432"]
        end
        
        subgraph "Automation"
            N8N["n8n<br/>:5678"]
        end
    end
    
    subgraph "External"
        TELEGRAM["Telegram Channel<br/>@energynews"]
        BROWSER["Browser"]
    end
    
    BROWSER -->|"HTTPS :443"| STATIC
    STATIC -->|"API calls"| KONG
    KONG --> POSTGREST
    KONG --> REALTIME
    POSTGREST --> POSTGRES
    REALTIME --> POSTGRES
    
    TELEGRAM -->|"Parse"| N8N
    N8N -->|"Webhook POST"| KONG
```

### –ü–æ—Ä—Ç—ã –∏ —Å–µ—Ä–≤–∏—Å—ã

| –°–µ—Ä–≤–∏—Å | –ü–æ—Ä—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|------|----------|
| NGINX | 80, 443 | –§—Ä–æ–Ω—Ç–µ–Ω–¥ + SSL |
| Kong (Supabase) | 8000 | API Gateway |
| PostgREST | 3000 | REST API |
| Realtime | 4000 | WebSocket |
| PostgreSQL | 5432 | –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö |
| n8n | 5678 | –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è |

---

## üóÑ –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `publications`

```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã publications
CREATE TABLE public.publications (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    news_id VARCHAR(50) UNIQUE NOT NULL,
    original_id INTEGER,
    title TEXT NOT NULL,
    slug VARCHAR(255) UNIQUE NOT NULL,
    full_text TEXT NOT NULL,
    plain_text TEXT,
    short_description TEXT,
    publication_date TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),
    published_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),
    category VARCHAR(100) NOT NULL DEFAULT '–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞',
    image_url TEXT,
    views_count INTEGER NOT NULL DEFAULT 0,
    likes_count INTEGER NOT NULL DEFAULT 0,
    source VARCHAR(20) NOT NULL DEFAULT 'telegram' CHECK (source IN ('telegram', 'manual')),
    telegram_post_id VARCHAR(50),
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),
    updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()
);

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
CREATE INDEX idx_publications_slug ON public.publications(slug);
CREATE INDEX idx_publications_category ON public.publications(category);
CREATE INDEX idx_publications_published_at ON public.publications(published_at DESC);
CREATE INDEX idx_publications_source ON public.publications(source);

-- –¢—Ä–∏–≥–≥–µ—Ä –¥–ª—è –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è updated_at
CREATE OR REPLACE FUNCTION public.update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = now();
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER update_publications_updated_at
    BEFORE UPDATE ON public.publications
    FOR EACH ROW
    EXECUTE FUNCTION public.update_updated_at_column();

-- RLS –ø–æ–ª–∏—Ç–∏–∫–∏
ALTER TABLE public.publications ENABLE ROW LEVEL SECURITY;

-- –ü—É–±–ª–∏—á–Ω–æ–µ —á—Ç–µ–Ω–∏–µ (–¥–ª—è –≤—Å–µ—Ö –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ–π —Å–∞–π—Ç–∞)
CREATE POLICY "Publications are publicly readable"
    ON public.publications
    FOR SELECT
    USING (true);

-- –í—Å—Ç–∞–≤–∫–∞ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ service_role (n8n webhook)
CREATE POLICY "Service role can insert publications"
    ON public.publications
    FOR INSERT
    WITH CHECK (auth.role() = 'service_role');

-- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ service_role
CREATE POLICY "Service role can update publications"
    ON public.publications
    FOR UPDATE
    USING (auth.role() = 'service_role');

-- Realtime –ø–æ–¥–ø–∏—Å–∫–∏
ALTER PUBLICATION supabase_realtime ADD TABLE public.publications;
```

### –¢–∞–±–ª–∏—Ü–∞ `contact_requests` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```sql
CREATE TABLE public.contact_requests (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(255) NOT NULL,
    email VARCHAR(255) NOT NULL,
    phone VARCHAR(50),
    company VARCHAR(255),
    message TEXT NOT NULL,
    status VARCHAR(20) NOT NULL DEFAULT 'new' CHECK (status IN ('new', 'processing', 'completed', 'spam')),
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()
);

ALTER TABLE public.contact_requests ENABLE ROW LEVEL SECURITY;

-- –ê–Ω–æ–Ω–∏–º–Ω–∞—è –≤—Å—Ç–∞–≤–∫–∞ (—Ñ–æ—Ä–º–∞ –Ω–∞ —Å–∞–π—Ç–µ)
CREATE POLICY "Anyone can submit contact request"
    ON public.contact_requests
    FOR INSERT
    WITH CHECK (true);

-- –ß—Ç–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ service_role
CREATE POLICY "Service role can read contact requests"
    ON public.contact_requests
    FOR SELECT
    USING (auth.role() = 'service_role');
```

---

## ‚öôÔ∏è –ò–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è Production

### 1. –°–æ–∑–¥–∞—Ç—å `.env.production`

```env
# Self-hosted Supabase –Ω–∞ Server 89
VITE_SUPABASE_URL=https://supabase.emc3.ru
VITE_SUPABASE_ANON_KEY=your-anon-key-here
VITE_SUPABASE_PROJECT_ID=emc3-energy
```

### 2. –û–±–Ω–æ–≤–∏—Ç—å `src/integrations/supabase/client.ts`

```typescript
import { createClient } from '@supabase/supabase-js';
import type { Database } from './types';

const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;
const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;

if (!supabaseUrl || !supabaseAnonKey) {
  throw new Error('Missing Supabase environment variables');
}

export const supabase = createClient<Database>(supabaseUrl, supabaseAnonKey, {
  auth: {
    storage: localStorage,
    persistSession: true,
    autoRefreshToken: true,
  }
});
```

### 3. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–∏–ø—ã –∏–∑ self-hosted Supabase

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Supabase CLI
npm install -g supabase

# –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–∏–ø—ã
npx supabase gen types typescript \
  --project-id emc3-energy \
  --schema public \
  > src/integrations/supabase/types.ts
```

### 4. –û–±–Ω–æ–≤–∏—Ç—å `src/hooks/useNews.ts`

```typescript
import { useQuery, useInfiniteQuery } from '@tanstack/react-query';
import { supabase } from '@/integrations/supabase/client';
import { NewsItem } from '@/types/news';

const PAGE_SIZE = 12;

export const useNewsList = (category: string = '–í—Å–µ') => {
  return useInfiniteQuery({
    queryKey: ['news', category],
    queryFn: async ({ pageParam = 0 }) => {
      let query = supabase
        .from('publications')
        .select('*')
        .order('published_at', { ascending: false })
        .range(pageParam * PAGE_SIZE, (pageParam + 1) * PAGE_SIZE - 1);

      if (category !== '–í—Å–µ') {
        query = query.eq('category', category);
      }

      const { data, error } = await query;

      if (error) throw error;

      return {
        items: data as NewsItem[],
        nextPage: data.length === PAGE_SIZE ? pageParam + 1 : undefined,
      };
    },
    getNextPageParam: (lastPage) => lastPage.nextPage,
    initialPageParam: 0,
  });
};

export const useLatestNews = (limit: number = 10) => {
  return useQuery({
    queryKey: ['latestNews', limit],
    queryFn: async () => {
      const { data, error } = await supabase
        .from('publications')
        .select('*')
        .order('published_at', { ascending: false })
        .limit(limit);

      if (error) throw error;
      return data as NewsItem[];
    },
  });
};

export const useNewsArticle = (slug: string) => {
  return useQuery({
    queryKey: ['newsArticle', slug],
    queryFn: async () => {
      const { data, error } = await supabase
        .from('publications')
        .select('*')
        .eq('slug', slug)
        .single();

      if (error) throw error;
      return data as NewsItem;
    },
    enabled: !!slug,
  });
};
```

### 5. –û–±–Ω–æ–≤–∏—Ç—å `src/components/Contact.tsx`

```typescript
// –î–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
const handleSubmit = async (e: React.FormEvent) => {
  e.preventDefault();
  
  const { error } = await supabase
    .from('contact_requests')
    .insert({
      name: formData.name,
      email: formData.email,
      phone: formData.phone,
      company: formData.company,
      message: formData.message,
    });

  if (error) {
    toast.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    return;
  }

  toast.success('–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!');
  setFormData({ name: '', email: '', phone: '', company: '', message: '' });
};
```

---

## üåê NGINX –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### `/etc/nginx/sites-available/emc3.ru`

```nginx
server {
    listen 80;
    server_name emc3.ru www.emc3.ru;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name emc3.ru www.emc3.ru;

    # SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã (Let's Encrypt)
    ssl_certificate /etc/letsencrypt/live/emc3.ru/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/emc3.ru/privkey.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256;
    ssl_prefer_server_ciphers off;

    # –ö–æ—Ä–Ω–µ–≤–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è
    root /var/www/emc3.ru/dist;
    index index.html;

    # Gzip —Å–∂–∞—Ç–∏–µ
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_proxied any;
    gzip_types text/plain text/css text/xml text/javascript 
               application/javascript application/x-javascript 
               application/xml application/json image/svg+xml;

    # SPA fallback ‚Äî –≤—Å–µ –º–∞—Ä—à—Ä—É—Ç—ã –Ω–∞ index.html
    location / {
        try_files $uri $uri/ /index.html;
    }

    # –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot|mp4|webm)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
        access_log off;
    }

    # –û—Ç–∫–ª—é—á–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ HTML
    location ~* \.html$ {
        expires -1;
        add_header Cache-Control "no-store, no-cache, must-revalidate";
    }

    # –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;

    # –õ–æ–≥–∏
    access_log /var/log/nginx/emc3.ru.access.log;
    error_log /var/log/nginx/emc3.ru.error.log;
}
```

### –ê–∫—Ç–∏–≤–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥–∞

```bash
sudo ln -s /etc/nginx/sites-available/emc3.ru /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

---

## üöÄ –ü—Ä–æ—Ü–µ—Å—Å –¥–µ–ø–ª–æ—è

### –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

```bash
# 1. –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
sudo mkdir -p /var/www/emc3.ru/dist
sudo chown -R $USER:$USER /var/www/emc3.ru

# 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
sudo certbot --nginx -d emc3.ru -d www.emc3.ru

# 3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å NGINX
sudo nano /etc/nginx/sites-available/emc3.ru
sudo ln -s /etc/nginx/sites-available/emc3.ru /etc/nginx/sites-enabled/
sudo nginx -t && sudo systemctl reload nginx
```

### –°–±–æ—Ä–∫–∞ –∏ –¥–µ–ø–ª–æ–π

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ
npm run build

# –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
scp -r dist/* user@server89:/var/www/emc3.ru/dist/

# –ò–ª–∏ —á–µ—Ä–µ–∑ rsync (–ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ)
rsync -avz --delete dist/ user@server89:/var/www/emc3.ru/dist/
```

### CI/CD —Å–∫—Ä–∏–ø—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```bash
#!/bin/bash
# deploy.sh

set -e

echo "üî® Building..."
npm run build

echo "üì¶ Deploying to server 89..."
rsync -avz --delete \
  --exclude '.git' \
  --exclude 'node_modules' \
  dist/ user@server89:/var/www/emc3.ru/dist/

echo "‚úÖ Deployed successfully!"
```

---

## üîó –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –¥—Ä—É–≥–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏

### –ü–æ—Ä—Ç–∞–ª —Ä–µ—à–µ–Ω–∏–π

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ | –ù–µ—Ç –ø—Ä—è–º–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è |
| –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ | –û—Ç–¥–µ–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ —Ç–æ–º –∂–µ —Å–µ—Ä–≤–µ—Ä–µ |

### n8n (Telegram ‚Üí Supabase)

```mermaid
sequenceDiagram
    participant TG as Telegram Channel
    participant N8N as n8n
    participant SB as Supabase API
    participant DB as PostgreSQL

    TG->>N8N: –ù–æ–≤—ã–π –ø–æ—Å—Ç
    N8N->>N8N: –ü–∞—Ä—Å–∏–Ω–≥ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
    N8N->>N8N: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è slug
    N8N->>N8N: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    N8N->>SB: POST /rest/v1/publications
    SB->>DB: INSERT
    DB-->>SB: OK
    SB-->>N8N: 201 Created
```

#### n8n Workflow –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```json
{
  "name": "Telegram to Supabase",
  "nodes": [
    {
      "type": "n8n-nodes-base.telegramTrigger",
      "parameters": {
        "channel": "@energynews"
      }
    },
    {
      "type": "n8n-nodes-base.function",
      "parameters": {
        "functionCode": "// –ü–∞—Ä—Å–∏–Ω–≥ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è slug"
      }
    },
    {
      "type": "n8n-nodes-base.httpRequest",
      "parameters": {
        "url": "https://supabase.emc3.ru/rest/v1/publications",
        "method": "POST",
        "headers": {
          "apikey": "{{ $env.SUPABASE_SERVICE_KEY }}",
          "Authorization": "Bearer {{ $env.SUPABASE_SERVICE_KEY }}",
          "Content-Type": "application/json"
        }
      }
    }
  ]
}
```

---

## ‚úÖ TODO —á–µ–∫–ª–∏—Å—Ç

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

- [ ] –°–æ–∑–¥–∞—Ç—å `.env.production` —Å credentials self-hosted Supabase
- [ ] –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–∏–ø—ã –∏–∑ self-hosted Supabase
- [ ] –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É `publications` –≤ self-hosted Supabase
- [ ] –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É `contact_requests` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å RLS –ø–æ–ª–∏—Ç–∏–∫–∏

### –ö–æ–¥

- [ ] –û–±–Ω–æ–≤–∏—Ç—å `src/integrations/supabase/client.ts`
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `src/hooks/useNews.ts` ‚Äî —É–±—Ä–∞—Ç—å MOCK_NEWS
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É —Ñ–æ—Ä–º—ã –≤ `src/components/Contact.tsx`
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ —Å production env

### –°–µ—Ä–≤–µ—Ä

- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å NGINX –∫–æ–Ω—Ñ–∏–≥ –¥–ª—è emc3.ru
- [ ] –ü–æ–ª—É—á–∏—Ç—å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (Let's Encrypt)
- [ ] –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `/var/www/emc3.ru/dist`
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

### –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è

- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å n8n workflow –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ Telegram
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å webhook –≤ n8n ‚Üí Supabase
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–≤—Ç–æ–∏–º–ø–æ—Ä—Ç –Ω–æ–≤–æ—Å—Ç–µ–π

### –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è

- [ ] –í—ã–ø–æ–ª–Ω–∏—Ç—å –ø–µ—Ä–≤—ã–π –¥–µ–ø–ª–æ–π
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –º–∞—Ä—à—Ä—É—Ç—ã
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –Ω–æ–≤–æ—Å—Ç–µ–π –∏–∑ –ë–î
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É —Ñ–æ—Ä–º—ã –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (uptime, –æ—à–∏–±–∫–∏)

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—å | –î–æ—Å—Ç—É–ø |
|------------|-------------|--------|
| `VITE_SUPABASE_URL` | `.env.production` | –ü—É–±–ª–∏—á–Ω—ã–π |
| `VITE_SUPABASE_ANON_KEY` | `.env.production` | –ü—É–±–ª–∏—á–Ω—ã–π |
| `SUPABASE_SERVICE_KEY` | n8n secrets | –ü—Ä–∏–≤–∞—Ç–Ω—ã–π |

### CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ Supabase

```sql
-- –í –∫–æ–Ω—Ñ–∏–≥–µ Kong/Supabase
-- –†–∞–∑—Ä–µ—à–∏—Ç—å —Ç–æ–ª—å–∫–æ emc3.ru
ALTER SYSTEM SET "app.cors_allowed_origins" = 'https://emc3.ru,https://www.emc3.ru';
```

### RLS –ø–æ–ª–∏—Ç–∏–∫–∏

| –¢–∞–±–ª–∏—Ü–∞ | SELECT | INSERT | UPDATE | DELETE |
|---------|--------|--------|--------|--------|
| `publications` | public | service_role | service_role | service_role |
| `contact_requests` | service_role | public | - | - |

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã

| –†–æ–ª—å | –ö–æ–Ω—Ç–∞–∫—Ç |
|------|---------|
| DevOps | - |
| Backend | - |
| Frontend | - |

---

*–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω: 2025-01-12*
*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 2025-01-12*
